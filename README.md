# Folder Compare Tool

A collection of PowerShell scripts for folder comparison and duplicate file detection with GUI folder selection.

## Scripts Overview

- **Compare-Folders.ps1** - Compare two folders with bidirectional analysis, supports MTP devices (phones via USB)
- **Find-DuplicateNames.ps1** - Recursively find all files with duplicate names in a folder hierarchy, calculate wasted disk space
- **Remove-Duplicates.ps1** - Automated duplicate file deletion using CSV output from Find-DuplicateNames

## Detailed Information

### Compare-Folders.ps1
Compare the contents of two folders with support for both regular Windows file system paths and MTP devices (phones, cameras connected via USB).

### Find-DuplicateNames.ps1
Find all files with duplicate names within a folder hierarchy, recursively scanning all subdirectories. Calculate total disk space occupied by duplicate files.

### Remove-Duplicates.ps1
Automated duplicate file deletion script that reads CSV files generated by Find-DuplicateNames.ps1 and safely removes duplicate files with confirmation options.

## Features

### Compare-Folders.ps1

- **GUI Folder Selection**: Native Windows folder browser dialogs for selecting folders
- **MTP Device Support**: Compare folders on phones and other portable devices connected via USB
- **Comprehensive Statistics**: 
  - Total size (MB and GB)
  - File and folder counts
  - Bidirectional comparison
- **Detailed Comparison Results**:
  - Files unique to Folder A
  - Files unique to Folder B
  - Folders unique to each location
  - Common files and folders
- **Export Functionality**: Save comparison results to a text file
- **Color-Coded Output**: Easy-to-read console output with different colors for different information types

### Find-DuplicateNames.ps1

- **GUI Folder Selection**: Choose root folder to scan using native Windows folder browser
- **Recursive Scanning**: Searches all subdirectories for files
- **Duplicate Detection**: Groups files by name (case-insensitive) and identifies duplicates
- **Disk Space Analysis**: Calculates total disk space occupied by duplicate files (space that would be freed by keeping only one copy)
- **Detailed Results**:
  - Shows occurrence count for each duplicate filename
  - Lists all locations where each duplicate appears
  - Displays file sizes (KB/MB) for each instance
  - Sorted table by total size (largest duplicates first)
- **Summary Statistics**: Total files scanned, unique names, duplicate counts, and disk space occupied by duplicates
- **Export Functionality**: 
  - Save detailed text report with sorted table and full file listings
  - Export machine-readable CSV for automated processing
  - Numbered suffix for multiple reports (DuplicateNames_1.txt, _2.txt, etc.)
- **CSV Export Options**:
  - Export ALL duplicate files (including first occurrence)
  - Export ONLY extra copies (keep first occurrence for safe deletion)
- **Color-Coded Output**: Clear, organized console display

### Remove-Duplicates.ps1

- **CSV-Based Deletion**: Reads CSV files generated by Find-DuplicateNames.ps1
- **Safety Modes**:
  - **WhatIf Mode**: Simulation mode to preview deletions without actually removing files
  - **Confirmation Mode**: Ask for confirmation before each file deletion
  - **Direct Mode**: Delete all files with single confirmation
- **Progress Tracking**: Real-time progress bars during deletion
- **Error Handling**: Gracefully handles missing files and permission errors
- **Disk Space Reporting**: Shows total space freed after deletion
- **Detailed Summary**: Success/failure/skip counts for all operations

## Requirements

- Windows PowerShell 5.1 or later
- Windows operating system

## Usage

### Compare-Folders.ps1

Run the script:

```powershell
.\Compare-Folders.ps1
```

The script will:
1. Prompt you to select Folder A using a GUI dialog
2. Prompt you to select Folder B using a GUI dialog
3. Analyze both folders recursively
4. Display comprehensive statistics and comparison results
5. Optionally export results to a timestamped text file

### Find-DuplicateNames.ps1

Run the script:

```powershell
.\Find-DuplicateNames.ps1
```

The script will:
1. Prompt you to select the root folder to scan using a GUI dialog
2. Recursively scan all files in the folder and subdirectories
3. Identify and group files with duplicate names
4. Calculate total disk space occupied by duplicates
5. Display detailed results with file locations, sizes, and sorted table
6. Optionally export results to `DuplicateNames.txt` (or numbered suffix if file exists)
7. Optionally export CSV file for automated duplicate handling

### Remove-Duplicates.ps1

Run the script with a CSV file:

```powershell
# Preview what would be deleted (safe mode)
.\Remove-Duplicates.ps1 -CsvPath "DuplicateNames_5.csv" -WhatIf

# Delete with confirmation for each file
.\Remove-Duplicates.ps1 -CsvPath "DuplicateNames_5.csv" -Confirm

# Delete all files (with single initial confirmation)
.\Remove-Duplicates.ps1 -CsvPath "DuplicateNames_5.csv"
```

The script will:
1. Load the CSV file generated by Find-DuplicateNames.ps1
2. Calculate total disk space to be freed
3. Display operation mode (WhatIf/Confirm/Direct)
4. Process deletions with progress tracking
5. Display detailed summary with success/failure counts

## Supported Folder Types

- Local drives (C:\, D:\, etc.)
- Network paths (UNC paths)
- MTP devices (phones, tablets, cameras via USB)
- Portable storage devices

## Example Output

### Compare-Folders.ps1

```
FOLDER STATISTICS
===============================================
Folder A: C:\MyPhotos
  Total Size: 2586.95 MB (2.53 GB)
  Files: 740
  Folders: 15

Folder B: [Phone]\Internal storage\DCIM
  Total Size: 2586.95 MB (2.53 GB)
  Files: 740
  Folders: 15

SUMMARY
===============================================
Common files: 740
Common folders: 15
Files unique to A: 0
Files unique to B: 0
```

### Find-DuplicateNames.ps1

```
SCAN RESULTS
===============================================

Found 93 file name(s) with duplicates:

File Name: Camera_2022-05-25_23_24.mp4
  Occurrences: 3
  Locations:
    - 20-5-2022\Camera_2022-05-25_23_24.mp4 (1.74 MB)
    - 23-5-2022\Camera_2022-05-25_23_24.mp4 (1.74 MB)
    - 29-5-2022\Camera_2022-05-25_23_24.mp4 (1.74 MB)

SUMMARY
===============================================
Total files scanned: 3499
Unique file names: 3406
Duplicate file names: 93
Total files with duplicate names: 279
Disk space occupied by duplicates: 587.03 MB
(This is the space you would free by keeping only one copy of each duplicate file)
Total run duration: 68.4 seconds

Would you like to export results to a file? (Y/N): y
Report saved to: C:\MyData\Git\FolderCompareTool\DuplicateNames_5.txt

Would you like to export a CSV file for automated duplicate handling? (Y/N): y

CSV Export Options:
1. Export ALL duplicate files (including the first occurrence)
2. Export ONLY extra copies (keep the first occurrence of each duplicate)
Select option (1 or 2): 2

CSV saved to: C:\MyData\Git\FolderCompareTool\DuplicateNames_5.csv
Total rows: 186

You can now pipe this CSV to a deletion script. Example:
  Import-Csv 'C:\MyData\Git\FolderCompareTool\DuplicateNames_5.csv' | ForEach-Object { Remove-Item $_.FullPath -WhatIf }
(Remove the -WhatIf parameter to actually delete files)
```

### Remove-Duplicates.ps1

```
Remove Duplicates Tool
======================

Loading CSV file...
Found 186 duplicate file(s) in the CSV.

Total disk space to be freed: 401.25 MB

Running in SIMULATION mode (-WhatIf). No files will be deleted.

Processing files...

WOULD DELETE: C:\MyData\folder\duplicate1.jpg (2.5 MB)
WOULD DELETE: C:\MyData\folder\duplicate2.jpg (3.1 MB)
...

===============================================
DELETION SUMMARY
===============================================
Files that would be deleted: 186
Files skipped: 0
Disk space that would be freed: 401.25 MB

Operation complete!
```

## Notes

### Compare-Folders.ps1
- The script performs recursive folder traversal
- File comparison is based on file names and relative paths
- For MTP devices, file size extraction uses Windows Shell namespace
- Large folders may take some time to analyze

### Find-DuplicateNames.ps1
- The script performs recursive folder traversal
- File comparison is case-insensitive (e.g., "File.txt" and "file.txt" are considered duplicates)
- Only compares filenames, not content
- Disk space calculation: Total size of extra copies (keeping one copy of each duplicate)
- Export files use `DuplicateNames.txt` as the base name, with numbered suffixes for multiple reports
- CSV export provides two options: all duplicates or only extra copies for safe deletion
- Large folder structures may take time to scan (e.g., 64,000 files in ~7.5 minutes)

### Remove-Duplicates.ps1
- **IMPORTANT**: Always run with `-WhatIf` first to preview deletions
- CSV files must be generated by Find-DuplicateNames.ps1 to ensure proper format
- Deleted files are permanently removed (not sent to Recycle Bin)
- Script handles missing files gracefully (if already deleted)
- Use option 2 in CSV export to keep the first occurrence of each duplicate
- `-Confirm` mode allows selective deletion for manual review

## Workflow Example

1. **Find duplicates**:
   ```powershell
   .\Find-DuplicateNames.ps1
   # Select folder, export report and CSV (option 2: extra copies only)
   ```

2. **Preview deletions** (safe):
   ```powershell
   .\Remove-Duplicates.ps1 -CsvPath "DuplicateNames_1.csv" -WhatIf
   ```

3. **Delete duplicates** (after reviewing):
   ```powershell
   .\Remove-Duplicates.ps1 -CsvPath "DuplicateNames_1.csv"
   # Type 'YES' to confirm
   ```

## License

Free to use and modify.
